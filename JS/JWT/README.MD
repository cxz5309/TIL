# JWT(Json Web Token, jot)
- 전자 서명 된 URL-safe (URL로 이용할 수있는 문자 만 구성된)의 JSON이다.
- 전자 서명은 JSON 의 변조를 체크 할 수 있게되어 있다.
- JWT는 속성 정보 (Claim)를 JSON 데이터 구조로 표현한 토큰으로 RFC7519 표준이다.
- JWT는 서버와 클라이언트 간 정보를 주고 받을 때 Http 리퀘스트 헤더에 JSON 토큰을 넣은 후 서버는 별도의 인증 과정없이 헤더에 포함되어 있는 JWT 정보를 통해 인증한다.
- 이때 사용되는 JSON 데이터는 URL-Safe 하도록 URL에 포함할 수 있는 문자만으로 만든다.
- JWT는 HMAC 알고리즘을 사용하여 비밀키 또는 RSA를 이용한 Public Key/ Private Key 쌍으로 서명할 수 있다.

## jwt 토큰의 구성요소
- JWT는 세 파트로 나누어지며, 각 파트는 점로 구분하여 xxxxx.yyyyy.zzzzz 이런식으로 표현됩니다. 순서대로 헤더 (Header), 페이로드 (Payload), 서명 (Sinature)로 구성합니다.

> HEADER.PAYLOAD.SIGNATURE  
- 헤더(Header), 페이로드(Payload), 서명(Signature) 세 부분을 점(.)으로 구분하는 구조다.

1. Header
   - 헤더는 토큰의 타입과 해시 암호화 알고리즘으로 구성되어 있다. 첫째는 토큰의 유형 (type: JWT)을 나타내고, 두 번째는 HMAC, SHA256 또는 RSA와 같은 암호화 방식(alg: HS256)을 나타낸다.
2. Payload
   - 페이로드는 토큰에 담을 클레임(claim) 정보를 포함하고 있다. Payload 에 담는 정보의 한 ‘조각’ 을 클레임이라고 부르고, 이는 name / value 의 한 쌍으로 이뤄져있다. 토큰에는 여러개의 클레임 들을 넣을 수 있으며 모든 클레임들을 클레임 셋(Claim Set)이라고 부른다.
   - 클레임 셋은 JWT에 대한 내용(토큰 생성자(클라이언트)의 정보, 생성 일시 등)이나 클라이언트와 서버 간 주고 받기로 한 값들로 구성된다.
   - 클레임의 정보는 등록된 (registered) 클레임, 공개 (public) 클레임, 비공개 (private) 클레임으로 세 종류가 있다.

3. Signature
   - 서명은 secret key를 포함하여 암호화되어 있다.

## 기존 방식과의 비교
### 쿠키/세션 방식과 jwt방식의 비교
### 쿠키/세션 방식
- 쿠키/세션 방식의 인증은 기본적으로 세션 저장소(redis 등)를 필요로 한다. 세션 저장소는 로그인을 했을 때 사용자의 정보를 저장하고 열쇠가 되는 세션 ID값(쿠키)을 만든다. 
- 그리고 HTTP 헤더에 실어 사용자에게 돌려보낸다. 그러면 사용자는 쿠키로 보관하고 있다가 인증이 필요한 요청에 쿠키(세션ID)를 넣어 보낸다. 
- 쿠키 자체(세션 ID)는 유의미한 값을 갖고있지 않기 때문에 쿠키에 담긴 HTTP 요청이 도중에 노출이 되더라도 안전하다. 
- 일일이 회원정보를 확인할 필요가 없이 바로 어떤 회원인지를 확인할 수 있어서 서버의 자원에 접근하기 용이하다. 

> - 그러나 쿠키 방식은 쿠키 탈취 자체는 안전하나, 만약에 HTTP 요청을 해커가 가로챈다면 그 안에 있는 쿠키를 가로채서 HTTP 요청을 보낼 수 있다. (세션 하이재킹 공격) => HTTPS 사용을 통해 요청을 탈취해도 안의 정보를 읽기 힘들게 한다, 세션에 유효기간을 넣어주는 것으로 일부 해결할 수 있다.
> - 쿠키 방식은 유저가 쿠키 정보를 보내지 않는 경우가 자주 있다.

### JWT 방식
- 인증에 필요한 정보들을 암호화시킨 토큰을 Access Token을 HTTP 헤더에 실어 서버로 보내게 된다.
- 쿠키/세션 방식과 달리 JWT는 발급한 후 검증만 하면 되기 때문에 추가 저장소가 필요 없다.
- 이는 Stateless 한 서버를 만들 때 큰 강점이 되고 그건 다시 말해 서버를 확장하거나 유지,보수하는데 유리하다.

> - 그러나 JWT는 이미 발급된 경우 돌이킬 수 없으므로 관리자의 손 밖에서 유효 기간동안 지속적으로 악의적인 사용이 가능하다. => 토큰의 유효기간을 짧게 하고 Refresh Token을 지속적으로 새로 발급한다.
> - payload의 정보가 제한적이다. payload는 직접 암호화하지 않는다면 디코딩 시 누구나 정보를 확인할 수 있게 되기 때문에 중요 정보는 payload에 넣을 수 없다.
> - 또한 쿠키/세션 방식에 비해 길이가 길기 때문에 요청이 많을 수록 쿠키/세션 방식보다 서버의 자원 낭비가 심해진다.

### OAuth 방식과 jwt방식의 비교
### OAuth 방식 
- 기존의 토큰 인증 방식으로 서비스를 받기 위해서는 토큰의 유효성을 확인하여 세부 정보를 쿼리해야한다.
- 참조에 의한 호출(By Reference) 형태로 모든 서비스는 항상 상호 작용할 때 다시 접속해야한다.

### jwt방식
- 값에 의한 호출이 가능한 토큰을 통해 값에 의한 호출(By Value) 형태
- 토큰이 필요한 모든 정보를 포함하고 있어 참조(적어도 인증 및 권한 부여를 위해)가 필요없기 때문에 서비스 자체에서 유효성을 검증한다.

## JWT 장점
- JWT 의 주요한 이점은 사용자 인증에 필요한 모든 정보는 토큰 자체에 포함하기 때문에 별도의 인증 저장소가 필요없다는 것이다.
- 중앙 집중식 인증 서버와 데이터베이스에 의존하지 않는 쉬운 인증 및 인가 방법을 제공한다.
- 토큰 검증과 검증에 필요한 비밀 키를 처리하기위한 미들웨어로 검증한다. 검증은 서명 및 클레임과 같은 몇 가지 매개 변수를 검사하는 것과 토큰이 만료되는 경우로 구성한다.
- 토큰이 올바르게 서명되었는지 확인하는 것은 네트워크 액세스가 필요하지 않으며 최신 웹 서버 하드웨어에서 확장하기가 쉽다.
- 서버에서는 사용자에 대한 세션을 유지 할 필요가 없다. 즉 사용자가 로그인되어있는지 안되어있는지 신경 쓸 필요가 없고, 사용자가 요청을 했을때 토큰만 확인하면 되므로 세션 관리가 필요 없어서 서버 자원과 비용을 절감할 수 있다.

## JWT 단점
- 토큰은 클라이언트에 저장되어 데이터베이스에서 사용자 정보를 조작하더라도 토큰에 직접 적용할 수 없다.
- Stateless한 애플리케이션에서 토큰은 거의 모든 요청에 대해 전송되므로 데이터 트래픽 크기에 영향을 미칠 수 있다.
