# 마이크로 서비스
> - 마이크로서비스는 소프트웨어가 잘 정의된 API를 통해 통신하는 소규모의 독립적인 서비스로 구성되어 있는 경우의 소프트웨어 개발을 위한 아키텍처 및 조직적 접근 방식입니다. 이러한 서비스는 독립적인 소규모 팀에서 보유합니다.  
> - 마이크로서비스 아키텍처는 애플리케이션의 확장을 용이하게 하고 개발 속도를 앞당겨 혁신을 실현하고 새로운 기능의 출시 시간을 단축할 수 있게 해 줍니다.  
> https://aws.amazon.com/ko/microservices/

![microservice](/public/JS/microservice.png)
> 모놀리식 아키텍처와 마이크로서비스 아키텍처 비교  

- 모놀리식 아키텍쳐는 모든 프로세스가 단일 서비스로 실행된다. 따라서 확장성, 가용성 등이 부족하다.  
- 그러나 마이크로서비스 아키텍처는 애플리케이션의 각각의 서비스가 독립적으로 구축되기 때문에 각각의 서비스 업데이트를 빠르고 자유롭게 가능하며 필요한 경우 확장성이 매우 좋다.  
### 마이크로 서비스의 이점
1. 민첩성
   - 마이크로서비스는 해당 서비스를 소유한 독립적인 소규모 팀 조직을 육성하는 역할을 합니다. 팀은 충분한 이해를 바탕으로 하는 소규모 컨텍스트 내에서 활동하며 더 독립적이면서 신속하게 업무를 수행할 수 있습니다. 덕분에 개발 주기 시간이 단축됩니다. 그리고 조직의 집계 처리량 측면에서 큰 이점을 누리게 됩니다.
2. 유연한 확장성
   - 마이크로서비스의 경우 각 서비스가 지원하는 애플리케이션 기능의 수요를 충족하도록 해당 서비스를 독립적으로 확장할 수 있습니다. 따라서 팀은 필요한 인프라의 규모를 적절히 조절하고, 기능의 비용을 정확하게 측정하고, 서비스의 수요가 급증하는 경우에도 가용성을 유지할 수 있습니다.
3. 손쉬운 배포
   - 마이크로서비스는 지속적 통합 및 지속적 전달을 통해 새로운 아이디어를 손쉽게 시험하고 문제가 발생할 경우 간단히 롤백할 수 있게 해 줍니다. 이처럼 저렴한 실패 비용 덕분에 실험을 진행할 수 있어 더 쉽게 코드를 업데이트하고 새로운 기능의 출시 시간을 앞당길 수 있습니다.
4. 기술적 자유
   - 마이크로서비스 아키텍처는 “모든 규모에 부합하는” 접근 방식을 추구하지 않습니다. 팀은 특정한 문제를 해결하는 데 가장 적합한 도구를 자유롭게 선택할 수 있습니다. 따라서 마이크로서비스를 구축하는 팀은 작업별로 가장 적합한 도구를 선택할 수 있습니다.
5. 재사용 가능한 코드
   - 소프트웨어를 잘 정의된 소규모 모듈로 분할하면 팀이 기능을 여러 용도로 사용할 수 있게 됩니다. 특정 기능을 위해 구축된 서비스를 다른 기능의 빌딩 블록으로 사용할 수 있는 것입니다. 이를 통해 개발자가 코드를 처음부터 작성하지 않고도 새 기능을 생성할 수 있어 애플리케이션이 자체적으로 부트스트랩 작업을 생성할 수 있습니다.
6. 복원성
   - 서비스가 독립적이므로 실패에 대한 애플리케이션의 저항성이 증가합니다. 모놀리식 아키텍처에서는 단일 구성 요소가 실패하는 경우 전체 애플리케이션이 실패하게 될 수 있습니다. 마이크로서비스에서는 기능을 저하시키고 전체 애플리케이션을 충돌시키지 않는 방식으로 전체 서비스 실패를 처리합니다.


> 처음으로 서버를 제대로 사용해 보고 많은 코딱지 서버(ec2 t2 micro)의 폭발을 경험하며 서버 가용성에 대해 관심을 가지게 되었다.   

> ### 마이크로서비스를 실제로 실행한 방법들이다.   
### 1. RDS, ElastiCache, 젠킨스 전용 서버  
젠킨스를 사용하였는데 젠킨스가 코딱지서버의 자원을 너무 먹는것 같아 전용 ec2 서버를 따로 만들었다. 그러나 서버의 남는 공간이 너무 낭비였기에 중단하였다.  
우선, 서버의 각 기능을 나누었다. mysql을 사용하였기에 가용성과 백업 서비스 등 지원으로 rds를 사용하였다.  
> [AWS RDS](/JS/AWS%20RDS/readme.md)  

이후에는 redis를 사용하며 인 메모리 서비스가 필요하게 되어 elastiCache를 사용하게 되었다.   
단순히 redis서버를 위해 만들었으나 기본 노드를 복제하여 실패한 기본 클러스터를 조치하는 다중 AZ 기능까지 기본적으로 지원하는 좋은 서비스였다.  

> [AWS ElastiCache](/JS/AWS%20ElastiCache/readme.md)   


### 2. docker  
도커를 사용하였다. 현재 컴퓨팅 자원을 이용한 가상머신을 새 서버로 이용한다는 개념인데 파이썬 가상 환경과 어느 정도 비슷하다고 볼 수 있다.    
#### 도커를 사용하는 장점 
- 실행 환경의 빠른 이식이 가능하다. 다른 ec2 서버에 이전 환경을 이식하려면 꽤 오래 걸렸는데 도커 이미지 생성 이후 도커 사용만으로 해결할 수 있게 되었다.  

#### 도커를 여러 개 사용하는 장점 -> 컨테이너 오케스트레이션의 기능
- 1. 또한 도커 컨테이너를 여러 개 실행하는 것으로 RDS, ElastiCache를 사용한 것 처럼 서비스를 잘게 쪼개어 각각의 도커 컨테이너에서 돌릴 수 있다. 작은 서비스이기 때문에 이 부분은 하지 않았다. -> 마이크로서비스 
- 2. 비슷하게 서비스를 기능별로 쪼개지는 않았지만 동일한 서버를 만들어 사용자 요청 트래픽을 분산할 수 있다. -> 로드 밸런싱 
- 3. 만약 서비스를 잘게 쪼갰고 트래픽까지 분산하였다고 할 때 가용 공간 내에서만 부하가 분산된다면 불균형이 생긴다. 전체 서버의 부하를 균등하게 한다면? -> 교차 영역 로드 밸런싱  
- 5. 만약 서비스중인 docker 컨테이너 하나가 고장나거나 업데이트 등의 이유로 잠깐 멈추어야 할 때 사용자는 이용을 못하게된다. 하지만 그 때 컨테이너가 2개가 동시에 실행되고 사용이 불가한 컨테이너 대신 사용 가능한 컨테이너(헬스 체크) 를 서비스하게 되면 사용자는 무중단 서비스를 이용할 수 있게 된다. -> 블루/그린 배포
- 6. 마지막으로 만약 이러한 작업들을 했는데도 서버 가용성이 부족해서 서버를 늘려야 한다면? 도커는 가상머신을 사용하기 때문에 새로운 서버를 늘리는 것이 매우 쉽고 빠르다. -> Auto Scaling(Scale Out)
- 7. 추가로 서버를 늘리는 것이 아니라 서버의 크기를 키우는 것이 활용도가 더 좋을 수 있다면 어떻게 해야 할까 -> Auto Scaling(Scale Up) 


> [Docker](/JS/docker란/readme.md)  

### 3. AWS ECS(Amazon Elastic Container Service)  
1, 2, 3, 4, 5, 6 에 대한 모든 기술적 지원을 AWS ECS에서 해준다.   
이러한 '컨테이너를 관리하는 기술'을 컨테이너 오케스트레이션 이라고 한다. 도커 스웜, 쿠버네티스, Apache Mesos, AWS ECS 등 많은 오케스트레이션 툴이 있고 우리는 ECS를 사용했다.  
ECS는 클러스터라는 이름으로 서비스들을 묶는다. 클러스터 내부에는 다양한 서비스가 있을 수 있고 그 서버인 인스턴스가 여러 개 있을 수 있다. 인스턴스 내부에는 그 서비스가 실제 실행되는 도커 컨테이너가 존재하는 형식이다.   
> [AWS ECS](/JS/AWS%20ECS/readme.md)  

> ecs라는 관리 툴 안에서 각각의 기능을 사용하기 위해 다양한 툴을 이용하였다.  

### 4. AWS CodePipeline  
클러스터 오케스트레이션에서 필수 기능이라고 할 수 있는 배포 자동화 서비스이다. 만일 수많은 컨테이너를 자동으로 배포하는 기능이 없다면 배포하는데에만 하루종일이 걸릴 것이다.  
다양한 ci/cd 툴 중 AWS에서의 통일성을 위해 CodePipeline을 선택했다.    
> [CI&CD](/JS/CI&CD/READMD.MD)  
> [AWS CodePipeline](/JS/AWS%20CodePipeline/readme.md)  
### 5. AWS ECR(Amazon Elastic Container Registry)
도커 이미지의 저장을 위해 ECR을 사용하였다. ECS와의 사용 연계가 좋으며 호스팅 성능이 좋다.  
### 6. AWS ELB(Amazon Elastic Load Balancing)
ECS의 핵심 기능이라고 볼 수 있는 로드밸런싱이다. l4와 l7등의 계층 중 l7 Application Loadbalancer를 이용하였고 블루/그린 배포, 부하 분산, https 포트포워딩 등에 사용되었다.  
> [LoadBalancing](/js/LoadBalancing/readme.md)  
### 7. AWS CloudWatch
AWS에서 오케스트레이션의 모니터링을 맡고있는 기능이다. 트래픽을 분석, 시각화하며 경보를 설정할 수도 있으며, 간단하게 전체 컨테이너의 로그를 확인할 수도 있다.  

</br>  

> 출처
> https://aws.amazon.com/ko/microservices/